/*! For license information please see main.js.LICENSE.txt */
"use strict";(("undefined"!=typeof self?self:this).webpackChunkui_sample_project=("undefined"!=typeof self?self:this).webpackChunkui_sample_project||[]).push([[792],{5771:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var r,o=n(6540),a=n(2280),l=n(1678),c=n(5353),i=n(913),u=n(551),f=n(9146),s=n(1892),m=n(8263),d=n(1052),b=n(2609),p=n(6771),y=n(9290),g=n(9654),v=n(1570),E=n(3034),h=n(3411);const S=(r=function(e){var t=e.title,n=e.count,r=e.lang;return"/api/generate?title=".concat(t,"&count=").concat(n,"&lang=").concat(r)},function(e){var t=e.onUpdate,n=e.onOpen,o=e.onClose,a=e.onError;return function(e){try{var l=new EventSource(r(e));return l.onmessage=function(e){t(JSON.parse(e.data))},l.onopen=function(e){null==n||n()},l.addEventListener("end",function(e){null==o||o(),l.close()}),l.onerror=function(e){null==a||a(e),this.readyState==EventSource.CONNECTING?console.log("Переподключение (readyState=".concat(this.readyState,")...")):console.log("Произошла ошибка.")},function(){return l.close()}}catch(e){null==a||a(e)}}});function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,c=[],i=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var w=n(9962),k=n(4168);function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function P(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var i=r&&r.prototype instanceof c?r:c,u=Object.create(i.prototype);return T(u,"_invoke",function(n,r,o){var a,c,i,u=0,f=o||[],s=!1,m={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return a=t,c=0,i=e,m.n=n,l}};function d(n,r){for(c=n,i=r,t=0;!s&&u&&!o&&t<f.length;t++){var o,a=f[t],d=m.p,b=a[2];n>3?(o=b===r)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,m.v=r,m.n=a[1]):d<b&&(o=n<3||a[0]>r||r>b)&&(a[4]=n,a[5]=r,m.n=b,c=0))}if(o||n>1)return l;throw s=!0,r}return function(o,f,b){if(u>1)throw TypeError("Generator is already running");for(s&&1===f&&d(f,b),c=f,i=b;(t=c<2?e:i)||!s;){a||(c?c<3?(c>1&&(m.n=-1),d(c,i)):m.n=i:m.v=i);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(s=m.n<0)?i:n.call(r,m))!==l)break}catch(t){a=e,c=1,i=t}finally{u=1}}return{value:t,done:s}}}(n,o,a),!0),u}var l={};function c(){}function i(){}function u(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(T(t={},r,function(){return this}),t),s=u.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,T(e,o,"GeneratorFunction")),e.prototype=Object.create(s),e}return i.prototype=u,T(s,"constructor",u),T(u,"constructor",i),i.displayName="GeneratorFunction",T(u,o,"GeneratorFunction"),T(s),T(s,o,"Generator"),T(s,r,function(){return this}),T(s,"toString",function(){return"[object Generator]"}),(P=function(){return{w:a,m}})()}function T(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}T=function(e,t,n,r){function a(t,n){T(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},T(e,t,n,r)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(t){A(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function A(e,t,n){return(t=function(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e,t,n,r,o,a,l){try{var c=e[a](l),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,o)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function l(e){z(a,r,o,l,c,"next",e)}function c(e){z(a,r,o,l,c,"throw",e)}l(void 0)})}}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,c=[],i=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return U(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var I=function(e){var t,n=e.card,r=e.imageUuid;return o.createElement(a.Z,null,o.createElement(l.a,null,o.createElement(c.D,{size:"md"},null==n?void 0:n.title)),o.createElement(i.b,null,o.createElement(u.T,{align:"stretch",spacing:4},o.createElement(f.a,{position:"relative",width:"100%",paddingBottom:"100%"},o.createElement(f.a,{position:"absolute",top:0,left:0,right:0,bottom:0},r?r?o.createElement(m._,{src:"/api/card-image/".concat(r),alt:null==n?void 0:n.title,borderRadius:"md",objectFit:"cover",width:"100%",height:"100%"}):null:o.createElement(s.E,{width:"100%",height:"100%",borderRadius:"md",startColor:"gray.100",endColor:"gray.300"}))),o.createElement(f.a,null,o.createElement(d.E,{color:"chakra-body-text"},null==n?void 0:n.description)),o.createElement(b.z,{justify:"space-between"},o.createElement(f.a,null,o.createElement(d.E,{fontWeight:"bold",color:"chakra-body-text"},"Цена"),o.createElement(d.E,{fontSize:"xl",color:"chakra-body-text"},null==n?void 0:n.price," ₽")),o.createElement(f.a,null,o.createElement(d.E,{fontWeight:"bold",color:"chakra-body-text"},"Рейтинг"),o.createElement(b.z,null,o.createElement(w.uDe,{color:"gold"}),o.createElement(d.E,{color:"chakra-body-text"},null==n?void 0:n.rating)))),o.createElement(f.a,{borderTop:"1px",borderColor:"chakra-border-color",pt:4}),o.createElement(f.a,null,o.createElement(d.E,{fontWeight:"bold",mb:2,color:"chakra-body-text"},"Отзывы:"),o.createElement(u.T,{align:"stretch",spacing:3},null==n||null===(t=n.comments)||void 0===t?void 0:t.map(function(e,t){return o.createElement(f.a,{key:t,p:2,bg:"chakra-subtle-bg",borderRadius:"md"},o.createElement(b.z,null,o.createElement(p.e,{size:"sm",name:null==e?void 0:e.name}),o.createElement(u.T,{align:"start",spacing:0},o.createElement(d.E,{fontWeight:"bold",color:"chakra-body-text"},null==e?void 0:e.name),o.createElement(d.E,{fontSize:"sm",color:"chakra-body-text"},null==e?void 0:e.text),o.createElement(b.z,null,o.createElement(w.uDe,{color:"gold"}),o.createElement(d.E,{fontSize:"sm",color:"chakra-body-text"},null==e?void 0:e.rating)))))}))))))},F=o.memo(I);const N=function(){var e,t=function(){var e=O((0,o.useState)({}),2),t=e[0],n=e[1],r=O((0,o.useState)(!1),2),a=r[0],l=r[1],c=(0,o.useRef)(function(){}),i=(0,o.useCallback)(function(e){var t,r=e.title,o=e.count,a=e.lang;null===(t=c.current)||void 0===t||t.call(c),l(!0),c.current=S({onUpdate:n,onClose:function(){l(!1)},onError:function(){l(!1)}})({title:r,count:o,lang:a})},[n]);return(0,o.useEffect)(function(){return function(){var e;return null===(e=c.current)||void 0===e?void 0:e.call(c)}},[]),{data:t,invoke:i,isGenerating:a}}(),n=t.data,r=t.invoke,a=t.isGenerating,l=G((0,k.Hs)(),1)[0],i=G((0,o.useState)({}),2),u=i[0],s=i[1],m=G((0,o.useState)(null),2),b=m[0],p=m[1],j=(0,o.useRef)({}),w=(0,o.useDeferredValue)(null!==(e=null==n?void 0:n.cards)&&void 0!==e?e:[]);(0,o.useEffect)(function(){j.current=u},[u]);var x=(0,o.useCallback)(_(P().m(function e(){var t,r,o,a,c,i,u;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n){e.n=1;break}return e.a(2);case 1:if(t=null==n?void 0:n.cards,r=null==n?void 0:n.imagesStyle,t&&r){e.n=2;break}return e.a(2);case 2:for(o=0,a=j.current;o<t.length&&a[o];)o++;if(!(o>=t.length)){e.n=3;break}return console.log("Все изображения сгенерированы"),p(null),e.a(2);case 3:if(p(o),e.p=4,null==(c=t[o])||!c.imagePrompt){e.n=9;break}return e.n=5,l({imagePrompt:c.imagePrompt,imagesStyle:r}).unwrap();case 5:if(null==(i=e.v)||!i.uuid){e.n=7;break}return console.log("Сохранение UUID для индекса",o,":",i.uuid),s(function(e){var t=C(C({},e),{},A({},o,i.uuid));return j.current=t,t}),e.n=6,new Promise(function(e){return setTimeout(e,1e3)});case 6:x(),e.n=8;break;case 7:console.error("Failed to generate image: no UUID returned"),p(null);case 8:e.n=10;break;case 9:x();case 10:e.n=12;break;case 11:e.p=11,u=e.v,console.error("Failed to generate image:",u),p(null);case 12:return e.a(2)}},e,null,[[4,11]])})),[n,l]);return(0,o.useEffect)(function(){n&&!a&&null===b&&0===Object.keys(u).length&&x()},[n,a,b,x,u]),o.createElement(y.m,{maxW:"container.xl",py:8},o.createElement(c.D,{mb:8},"Генерация Карточек товаров"),o.createElement(f.a,{as:"form",id:"form",onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n={title:t.get("title"),count:Number(t.get("count")),lang:t.get("lang")};s({}),p(null),r(n)},mb:8},o.createElement(g.B,{spacing:4},o.createElement(f.a,null,o.createElement(d.E,{mb:2},"Название товара:"),o.createElement(v.p,{id:"title",name:"title",defaultValue:"Чайник"})),o.createElement(f.a,null,o.createElement(d.E,{mb:2},"Язык:"),o.createElement("select",{id:"lang",name:"lang",style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #E2E8F0"}},o.createElement("option",{value:"ru"},"Russian"),o.createElement("option",{value:"en"},"English"))),o.createElement(f.a,null,o.createElement(d.E,{mb:2},"Количество карточек:"),o.createElement(v.p,{type:"number",id:"count",name:"count",defaultValue:2})),o.createElement(E.$,{type:"submit",colorScheme:"blue",size:"lg",isLoading:a},"Generate"))),w&&o.createElement(f.a,null,o.createElement(c.D,{size:"lg",mb:4},n.catalogName),o.createElement(d.E,{color:"chakra-body-text",mb:6},n.imagesStyle),o.createElement(h.r,{columns:{base:1,md:2,lg:3},spacing:6},null==w?void 0:w.map(function(e,t){return o.createElement(F,{key:t,card:e,imageUuid:u[t]})}))))}}}]);